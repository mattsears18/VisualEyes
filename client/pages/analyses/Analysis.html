<template name="Analysis">
  {{#if $.Session.get 'updateAnalysis'}}
    {{> UpdateAnalysis analysis=analysis}}
  {{else}}
    <h3 class="m-t-0">{{analysis.name}}
      {{#if analysis.hasPermission 'update'}}
        {{#unless $.Session.get 'updateAnalysis'}}
          &nbsp;<a href="#" class="update-analysis"><i class="fa fa-pencil"></i></a>
        {{/unless}}
      {{/if}}
      {{#unless makeViewingsJobsComplete}}
        <span class="label label-default">Creating Viewings
          {{makeViewingsJobsProgress}}%
          <i class="fa fa-spinner fa-pulse fa-fw"></i>
        </span>
      {{/unless}}
    </h3>

    <p>{{analysis.desc}}</p>

    {{#if analysis.period}}
    <div><strong>Period (ms):</strong> {{formatNumber analysis.period}}</div>
    {{/if}}

    {{#if analysis.centroidPeriod}}
    <div><strong>Centroid Period (ms):</strong> {{formatNumber analysis.centroidPeriod}}</div>
    {{/if}}

    {{#if analysis.viewingGap}}
    <div><strong>Viewing Gap (ms):</strong> {{formatNumber analysis.viewingGap}}</div>
    {{/if}}

    {{#if analysis.minViewingTime}}
      <div><strong>Minimum Viewing Time (ms):</strong> {{formatNumber analysis.minViewingTime}}</div>
    {{/if}}

    <div class="selector-set">
      <h4>
        Datafiles {{#if datafiles.count}}({{datafiles.count}}){{/if}}
        <button class="label label-primary toggle-all selector datafile">Show All</button>
      </h4>
      <h4>
        <div class="well well-sm">
          {{#each datafile in datafiles}}
            <button class="label selector datafile label-primary" data-id="{{datafile._id}}">{{datafile.name}}</button>
          {{/each}}
        </div>
      </h4>
    </div>

    <div class="selector-set">
      <h4>
        Areas of Interest {{#if aois.count}}({{aois.count}}){{/if}}
        <button class="label label-primary toggle-all selector aoi">Show All</button>
      </h4>
      <h4>
        <div class="well well-sm">
          {{#each aoi in aois}}
            <button class="label selector aoi label-primary" data-id="{{aoi._id}}">{{aoi.name}}</button>
          {{/each}}
        </div>
      </h4>
    </div>
    <!-- {{json showAoiIds}} -->








    {{#if viewings.count}}
      <div class="row">
        <div class="col-md-6">
          <div class="well">
            {{> PlotHistogram x=durations layout=durationsLayout name="Viewing-Durations"}}
            <table class="m-t-20">
              <tbody>
                <tr>
                  <tr>
                    <th>n:&nbsp;</th>
                    <td>
                      {{#if durations}}
                        {{formatNumber durations.length}}
                      {{/if}}
                    </td>
                  </tr>
                  <tr>
                    <th>Minimum:&nbsp;</th>
                    <td>
                      {{#if durationMin}}
                        {{millisecondsToHMSMS durationMin}}
                        [{{formatNumber durationMin}}]
                      {{/if}}
                    </td>
                  </tr>
                  <tr>
                    <th>Maximum:&nbsp;</th>
                    <td>
                      {{#if durationMax}}
                        {{millisecondsToHMSMS durationMax}}
                        [{{formatNumber durationMax}}]
                      {{/if}}
                    </td>
                  </tr>
                  <tr>
                    <th>Range:&nbsp;</th>
                    <td>
                      {{#if durationRange}}
                        {{millisecondsToHMSMS durationRange}}
                        [{{formatNumber durationRange}}]
                      {{/if}}
                    </td>
                  </tr>
                  <tr>
                    <th>Mean:&nbsp;</th>
                    <td>
                      {{#if durationMean}}
                        {{millisecondsToHMSMS durationMean}}
                        [{{formatNumber durationMean}}]
                      {{/if}}
                    </td>
                  </tr>
                  <tr>
                    <th>Median:&nbsp;</th>
                    <td>
                      {{#if durationMedian}}
                        {{millisecondsToHMSMS durationMedian}}
                        [{{formatNumber durationMedian}}]
                      {{/if}}
                    </td>
                  </tr>
                  <tr>
                    <th>Skewness:&nbsp;</th>
                    <td>
                      {{#if durationSkewness}}
                        {{formatNumber durationSkewness}}
                      {{/if}}
                    </td>
                  </tr>
                  <tr>
                    <th>Kurtosis:&nbsp;</th>
                    <td>
                      {{#if durationKurtosis}}
                        {{formatNumber durationKurtosis}}
                      {{/if}}
                    </td>
                  </tr>
                </tr>
              </tbody>
            </table>
          </div>
        </div>


        <div class="col-md-6">
          <div class="well">
            {{> PlotHistogram data=viewingCountsData layout=viewingCountsLayout name="Viewing-Counts"}}

            <table class="m-t-20">
              <tbody>
                <tr>
                  <th>n:&nbsp;</th>
                  <td>
                    {{#if viewingCounts}}
                      {{formatNumber viewingCounts.length}}
                    {{/if}}
                  </td>
                </tr>
                <tr>
                  <th>Minimum:&nbsp;</th>
                  <td>
                    {{#if viewingCountsMin}}
                      {{formatNumber viewingCountsMin}}
                    {{/if}}
                  </td>
                </tr>
                <tr>
                  <th>Maximum:&nbsp;</th>
                  <td>
                    {{#if viewingCountsMax}}
                      {{formatNumber viewingCountsMax}}
                    {{/if}}
                  </td>
                </tr>
                <tr>
                  <th>Range:&nbsp;</th>
                  <td>
                    {{#if viewingCountsRange}}
                      {{formatNumber viewingCountsRange}}
                    {{/if}}
                  </td>
                </tr>
                <tr>
                  <th>Mean:&nbsp;</th>
                  <td>
                    {{#if viewingCountsMean}}
                      {{formatNumber viewingCountsMean}}
                    {{/if}}
                  </td>
                </tr>
                <tr>
                  <th>Median:&nbsp;</th>
                  <td>
                    {{#if viewingCountsMedian}}
                      {{formatNumber viewingCountsMedian}}
                    {{/if}}
                  </td>
                </tr>
                <tr>
                  <th>Skewness:&nbsp;</th>
                  <td>
                    {{#if viewingCountsSkewness}}
                      {{formatNumber viewingCountsSkewness}}
                    {{/if}}
                  </td>
                </tr>
                <tr>
                  <th>Kurtosis:&nbsp;</th>
                  <td>
                    {{#if viewingCountsKurtosis}}
                      {{formatNumber viewingCountsKurtosis}}
                    {{/if}}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    {{/if}}








    {{#if viewings.count}}
      <h4>
        Viewings ({{viewings.count}})

        {{#unless makeViewingsJobsComplete}}
          <span class="label label-default">Creating Viewings
            {{makeViewingsJobsProgress}}%
            <i class="fa fa-spinner fa-pulse fa-fw"></i>
          </span>
        {{/unless}}
      </h4>

      {{> tabular table=TabularTables.ViewingsByAnalysisId selector=selector class="table table-striped table-bordered"}}
    {{/if}}
  {{/if}}
</template>
